<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–î–∞–Ω–Ω—ã–µ –ø–æ –¥–∞—Ç–µ ‚Äì 16 —Ç–∞–±–ª–∏—Ü</title>
  <style>
    /* –£–ë–ò–†–ê–ï–ú –ü–û–í–û–†–û–¢ –í–°–ï–ô –°–¢–†–ê–ù–ò–¶–´ - –í–ú–ï–°–¢–û –≠–¢–û–ì–û –ü–û–í–û–†–ê–ß–ò–í–ê–ï–ú –¢–û–õ–¨–ö–û –ö–û–ù–¢–ï–ô–ù–ï–† */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6fa;
      margin: 0;
      padding: 0;
      color: #333;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .rotated-container {
      transform: rotate(90deg);
      transform-origin: center center;
      width: 100vh;
      height: 100vw;
      display: flex;
      flex-direction: column;
      padding: 10px;
      box-sizing: border-box;
    }

    .container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .table-wrapper {
      overflow-x: auto;
      overflow-y: auto;
      position: relative;
      -webkit-overflow-scrolling: touch;
      flex: 1;
      margin: 0 auto;
      border: 1px solid #d7dce3;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      background: white;
    }

    table {
      border-collapse: collapse;
      width: auto;
      table-layout: fixed;
      background-color: white;
      min-width: 800px;
    }

    td, th {
      height: 22px;
      text-align: center;
      font-size: 11px;
      border: 1px solid #d7dce3;
      box-sizing: border-box;
      white-space: nowrap;
      vertical-align: middle;
      position: relative;
      transition: background-color 0.2s ease;
      padding: 0 3px;
    }

    th {
      background-color: #ecf0f1;
      color: #1a2f40;
      font-weight: 600;
    }

    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–µ—Ä–≤—ã–µ –¥–≤–∞ —Å—Ç–æ–ª–±—Ü–∞ */
    #main-table th:nth-child(1),
    #main-table td:nth-child(1),
    #main-table th:nth-child(2),
    #main-table td:nth-child(2) {
      position: sticky;
    }
    #main-table th:nth-child(1),
    #main-table td:nth-child(1) {
      left: 0;
      z-index: 30;
      background-color: #dc143c;
      color: white;
      width: 40px;
      min-width: 40px;
      max-width: 40px;
      font-weight: bold;
    }
    #main-table th:nth-child(2),
    #main-table td:nth-child(2) {
      left: 40px;
      z-index: 25;
      background-color: #2c3e50;
      color: white;
      width: 80px;
      min-width: 80px;
      max-width: 80px;
      overflow: hidden;
      font-weight: bold;
    }

    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ */
    #letter-row,
    #time-row {
      position: sticky;
      top: 0;
      z-index: 20;
    }
    
    #letter-row th:nth-child(1),
    #letter-row th:nth-child(2),
    #time-row th:nth-child(1),
    #time-row th:nth-child(2) {
      background-color: #ecf0f1 !important;
      color: #2c3e50 !important;
      border: 0px solid #d7dce3 !important;
      z-index: 40;
    }

    #letter-row th:nth-child(n+3) {
      background-color: #ecf0f1 !important;
      color: #2c3e50;
      border: 1px solid #e0e0e0 !important;
      width: 22px;
      min-width: 22px;
      max-width: 22px;
      z-index: 15;
    }
    #time-row th:nth-child(n+3) {
      white-space: normal;
      padding: 2px 1px;
      line-height: 1;
      vertical-align: middle;
      border: 1px solid #e0e0e0;
      width: 22px;
      min-width: 22px;
      max-width: 22px;
      background-color: #ecf0f1;
      z-index: 10;
    }
    #time-row th div {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #time-row th .hour {
      font-size: 10px;
      font-weight: bold;
    }
    #time-row th .minute {
      font-size: 10px;
    }

    .hidden-column {
      display: none !important;
    }
    .active-cell {
      background-color: #2c3e50;
      color: #fff;
      font-weight: 700;
      position: relative;
    }
    .active-cell::after {
      content: 'üé≥';
      font-size: 10px;
    }
    td.hover-row, th.hover-row,
    td.hover-col, th.hover-col {
      background-color: rgba(250, 132, 156, 0.3) !important;
    }
    td.hover-col.active-cell {
      background-color: #4a6278 !important;
    }

    #date-picker {
      width: 100%;
      padding: 6px;
      font-size: 12px;
      font-family: 'Arial Black','Impact', sans-serif;
      border: 1px solid #ecf0f1;
      border-radius: 6px;
      background-color: #ecf0f1;
      color: #1a2f40;
      box-sizing: border-box;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      outline: none;
      font-weight: bold;
    }
    #date-picker:hover {
      background-color: #e0e0e0;
    }
    #date-picker:focus {
      background-color: white;
      border-color: #dc143c;
    }
    #date-picker::-webkit-calendar-picker-indicator {
      filter: invert(0.3);
      cursor: pointer;
      padding: 2px;
    }

    /* –ö–Ω–æ–ø–∫–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ */
    .toggle-btn {
      cursor: pointer;
      user-select: none;
      color: #fff;
      background-color: #1a2f40;
      border-radius: 3px;
      font-weight: bold;
      font-size: 11px;
      line-height: 18px;
      padding: 0 4px;
      display: inline-block;
      width: 8px;
      height: 20px;
      text-align: center;
      transition: all 0.2s ease;
      position: absolute;
      right: 2px;
      top: 50%;
      transform: translateY(-50%);
    }
    .toggle-btn:hover {
      background-color: #dc143c;
      transform: translateY(-50%) scale(1.1);
    }

    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }
    
    .control-btn {
      padding: 6px 12px;
      background-color: #2c3e50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: background-color 0.2s;
    }
    
    .control-btn:hover {
      background-color: #dc143c;
    }
    
    .current-date {
      flex-grow: 1;
      text-align: center;
      font-weight: bold;
      color: #2c3e50;
      padding: 6px;
      background-color: #ecf0f1;
      border-radius: 4px;
    }

    .cell-legend {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 2px;
      margin-right: 4px;
      vertical-align: middle;
    }
    
    .legend {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 10px;
      font-size: 11px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
    .table-wrapper::-webkit-scrollbar {
      width: 12px;
      height: 12px;
    }
    
    .table-wrapper::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 6px;
    }
    
    .table-wrapper::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 6px;
    }
    
    .table-wrapper::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }

    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    @media (max-width: 768px) {
      .rotated-container {
        padding: 8px;
      }
      
      .table-wrapper { 
        border-radius: 6px;
      }
      
      table { 
        min-width: 800px; 
      }
      
      #main-table th:nth-child(1),
      #main-table td:nth-child(1) { 
        width: 35px; 
        min-width: 35px; 
        max-width: 35px; 
      }
      
      #main-table th:nth-child(2),
      #main-table td:nth-child(2) { 
        left: 35px; 
        width: 70px; 
        min-width: 70px; 
        max-width: 70px; 
      }
      
      td, th { 
        font-size: 10px; 
        height: 20px; 
        padding: 0 2px;
      }
      
      #time-row th .hour, 
      #time-row th .minute { 
        font-size: 9px; 
      }
      
      .toggle-btn { 
        font-size: 10px; 
        height: 18px; 
        line-height: 16px; 
      }
      
      #date-picker {
        font-size: 11px;
        padding: 5px;
      }
      
      .controls {
        flex-direction: column;
      }
    }

    @media (max-width: 480px) {
      .rotated-container {
        padding: 5px;
      }
      
      #main-table th:nth-child(1),
      #main-table td:nth-child(1) { 
        width: 30px; 
        min-width: 30px; 
        max-width: 30px; 
      }
      
      #main-table th:nth-child(2),
      #main-table td:nth-child(2) { 
        left: 30px; 
        width: 60px; 
        min-width: 60px; 
        max-width: 60px; 
      }
      
      td, th { 
        font-size: 9px; 
        height: 18px; 
      }
      
      .toggle-btn { 
        font-size: 9px; 
        height: 16px; 
        line-height: 14px; 
        padding: 0 3px;
      }
    }
    
    /* –£–ª—É—á—à–µ–Ω–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255,255,255,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      font-size: 14px;
      color: #2c3e50;
      flex-direction: column;
      gap: 10px;
      border-radius: 8px;
    }
    
    /* –ö–Ω–æ–ø–∫–∞ "–ù–∞–≤–µ—Ä—Ö" –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
    .scroll-top-btn {
      position: absolute;
      right: 20px;
      bottom: 20px;
      background-color: #dc143c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      cursor: pointer;
      display: none;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      z-index: 100;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .scroll-top-btn:hover {
      background-color: #2c3e50;
    }
  </style>
</head>
<body>
  <div class="rotated-container">
    <div class="container">
      <div class="controls">
        <button class="control-btn" id="prev-day">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="current-date" id="current-date"></div>
        <button class="control-btn" id="next-day">–í–ø–µ—Ä–µ–¥ ‚Üí</button>
        <button class="control-btn" id="toggle-all">–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ</button>
        <button class="control-btn" id="today-btn">–°–µ–≥–æ–¥–Ω—è</button>
      </div>
      
      <div class="table-wrapper" id="table-wrapper">
        <table id="main-table">
          <thead>
            <tr id="letter-row">
              <th class="logo-cell" id="logo-wrapper" style="cursor: pointer;">
                <img src="https://i.postimg.cc/SQ3RgNsQ/image.png" alt="Logo" style="width:35px;height:35px;border-radius:0;" />
              </th>
              <th>
                <input type="date" id="date-picker" />
              </th>
            </tr>
            <tr id="time-row">
              <th>LANE</th>
              <th id="overall-total">0—á 0–º</th>
            </tr>
          </thead>
          <tbody id="table-body"></tbody>
        </table>
      </div>
      
      <div class="legend">
        <div class="legend-item">
          <span class="cell-legend" style="background-color: #2c3e50;"></span>
          <span>–ë—Ä–æ—Å–∫–∏</span>
        </div>
        <div class="legend-item">
          <span class="cell-legend" style="background-color: transparent; border: 1px solid #dc143c; color: #dc143c;">‚ö°Ô∏é</span>
          <span>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
        </div>
        <div class="legend-item">
          <span class="cell-legend" style="background-color: white;"></span>
          <span>–ë–µ–∑ –±—Ä–æ—Å–∫–æ–≤</span>
        </div>
      </div>
    </div>
    
    <button class="scroll-top-btn" id="scroll-top-btn">‚Üë</button>
  </div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwJcg8Ov4_-ijxTLQxJDjm2-IKCmI8l0AAsDo4sMeU-avSQp3F_E54gyB7f26z_KaE0FA/exec';
    const totalMinutes = 1440, groupInterval = 15, groupSize = 14;
    const letterRow = document.getElementById('letter-row'),
          timeRow = document.getElementById('time-row'),
          overallTotal = document.getElementById('overall-total'),
          tableBody = document.getElementById('table-body'),
          datePicker = document.getElementById('date-picker'),
          currentDateEl = document.getElementById('current-date'),
          prevDayBtn = document.getElementById('prev-day'),
          nextDayBtn = document.getElementById('next-day'),
          toggleAllBtn = document.getElementById('toggle-all'),
          todayBtn = document.getElementById('today-btn'),
          tableWrapper = document.getElementById('table-wrapper'),
          scrollTopBtn = document.getElementById('scroll-top-btn');
    
    const allGroups = [], allDataCells = [];
    let isLoading = false;
    const fetchControllers = new Map();

    function formatMinutes(mins) {
      const h = Math.floor(mins / 60);
      const m = mins % 60;
      return `${h}—á ${m}–º`;
    }

    function formatDateForDisplay(dateStr) {
      const date = new Date(dateStr);
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      return date.toLocaleDateString('ru-RU', options);
    }

    function updateDateDisplay(dateStr) {
      currentDateEl.textContent = formatDateForDisplay(dateStr);
    }

    function toggleGroup(idxs) {
      idxs.forEach(i => {
        [timeRow, letterRow].forEach(row => {
          if (row.children[i+2]) row.children[i+2].classList.toggle('hidden-column');
        });
        tableBody.querySelectorAll('tr').forEach(tr => {
          if (tr.children[i+2]) tr.children[i+2].classList.toggle('hidden-column');
        });
      });
    }

    function areAllHidden() {
      return allGroups.every(g => {
        const el = timeRow.children[g[0]+2];
        return el && el.classList.contains('hidden-column');
      });
    }

    function toggleAll(forceHide=null) {
      const shouldHide = forceHide !== null ? forceHide : !areAllHidden();
      allGroups.forEach(g => {
        const el = timeRow.children[g[0]+2];
        if (el) {
          const hidden = el.classList.contains('hidden-column');
          if (hidden !== shouldHide) toggleGroup(g);
        }
      });
      document.querySelectorAll('.toggle-btn').forEach(b => b.textContent = shouldHide ? '+' : '‚Äì');
      toggleAllBtn.textContent = shouldHide ? '–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ' : '–°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ';
    }

    function makeBtn(idxs, title) {
      const btn = document.createElement('div');
      btn.className = 'toggle-btn';
      btn.title = title;
      btn.textContent = '+';
      let last = 0;
      btn.onclick = (e) => {
        e.stopPropagation();
        const now = Date.now();
        if (now - last < 300) {
          toggleAll(!areAllHidden());
        } else {
          toggleGroup(idxs);
          btn.textContent = timeRow.children[idxs[0]+2].classList.contains('hidden-column') ? '+' : '‚Äì';
        }
        last = now;
      };
      return btn;
    }

    function buildHeaders() {
      const fragL = document.createDocumentFragment(), fragT = document.createDocumentFragment();
      for (let i = 1; i <= totalMinutes; i++) {
        const thL = document.createElement('th'); 
        fragL.appendChild(thL);
        const h = Math.floor((i - 1) / 60), m = (i - 1) % 60;
        const thT = document.createElement('th');
        thT.innerHTML = `<div class="hour">${String(h).padStart(2,'0')}</div><div class="minute">${String(m).padStart(2,'0')}</div>`;
        fragT.appendChild(thT);
        if ((h*60 + m) % groupInterval === 0) {
          const start = (h*60 + m) === 0 ? 1 : (h*60 + m) + 1;
          const end = Math.min(start + groupSize - 1, totalMinutes - 1);
          const idxs = [];
          for (let j = start; j <= end; j++) idxs.push(j);
          if (idxs.length) {
            fragL.lastChild.appendChild(makeBtn(idxs, `–°–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å ${formatMinutes(idxs[0])}‚Äì${formatMinutes(idxs[idxs.length-1])}`));
            allGroups.push(idxs);
          }
        }
      }
      letterRow.appendChild(fragL);
      timeRow.appendChild(fragT);
    }

    function buildBody() {
      const frag = document.createDocumentFragment();
      for (let lane = 0; lane < 16; lane++) {
        const tr = document.createElement('tr');
        const thLane = document.createElement('th'); 
        thLane.textContent = lane + 1; 
        tr.appendChild(thLane);
        const thCount = document.createElement('th'); 
        tr.appendChild(thCount);
        const cells = [];
        for (let i = 0; i < totalMinutes; i++) {
          const td = document.createElement('td');
          tr.appendChild(td);
          cells.push(td);
        }
        frag.appendChild(tr);
        allDataCells.push({ header: thCount, cells });
      }
      tableBody.appendChild(frag);
    }

    function clearRows() {
      fetchControllers.forEach(controller => controller.abort());
      fetchControllers.clear();
      overallTotal.textContent = '0—á 0–º';
      allDataCells.forEach(r => {
        r.header.textContent = '';
        r.cells.forEach(c => {
          c.classList.remove('active-cell');
          c.textContent = '';
          c.style.color = '';
          c.style.backgroundColor = '';
        });
      });
    }

    function createLoadingOverlay() {
      const overlay = document.createElement('div');
      overlay.className = 'loading-overlay';
      overlay.innerHTML = `
        <div class="loading"></div>
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>
      `;
      tableWrapper.appendChild(overlay);
      return overlay;
    }

    async function loadLaneData(idx, selectedDate) {
      const controller = new AbortController();
      fetchControllers.set(idx, controller);
      try {
        const url = `${SCRIPT_URL}?action=getData&index=${idx}&date=${selectedDate}&t=${Date.now()}`;
        const response = await fetch(url, { signal: controller.signal });
        if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ HTTP: ${response.status}`);
        const data = await response.json();
        if (data.error) throw new Error(data.error);
        return data;
      } finally { 
        fetchControllers.delete(idx); 
      }
    }

    async function loadData() {
      if (!datePicker.value || isLoading) return;
      
      isLoading = true;
      const loadingOverlay = createLoadingOverlay();
      clearRows();
      
      const selectedDate = datePicker.value;
      updateDateDisplay(selectedDate);
      
      let done = 0, sumAll = 0;
      const errors = [];
      const promises = [];
      
      try {
        for (let idx = 0; idx < allDataCells.length; idx++) {
          promises.push(
            loadLaneData(idx, selectedDate)
              .then(data => {
                const row = allDataCells[idx];
                let sum = 0;
                row.cells.forEach((cell, i) => {
                  const time = `${String(Math.floor(i/60)).padStart(2,'0')}:${String(i%60).padStart(2,'0')}`;
                  cell.classList.remove('active-cell');
                  cell.textContent = '';
                  
                  if (data.c && data.c.includes(time)) { 
                    cell.classList.add('active-cell'); 
                    sum++; 
                  }
                  else if (data.b && data.b.includes(time)) { 
                    cell.style.backgroundColor = '#f8f9fa';
                  }
                  else { 
                    cell.textContent = '‚ö°Ô∏é'; 
                    cell.style.color = '#dc143c';
                  }
                });
                row.header.textContent = formatMinutes(sum);
                sumAll += sum;
                done++;
              })
              .catch(err => { 
                console.error(`–û—à–∏–±–∫–∞ –¥–æ—Ä–æ–∂–∫–∏ ${idx+1}:`, err); 
                errors.push(`–î–æ—Ä–æ–∂–∫–∞ ${idx+1}: ${err.message}`); 
                done++; 
              })
          );
        }
        
        await Promise.allSettled(promises);
        overallTotal.textContent = formatMinutes(sumAll);
        
        if (errors.length > 0) {
          console.warn(`–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–∞–º–∏: ${errors.join('; ')}`);
        } else {
          console.log(`–î–∞–Ω–Ω—ã–µ –∑–∞ ${selectedDate} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã. –í—Å–µ–≥–æ: ${formatMinutes(sumAll)}`);
        }
      } catch (error) { 
        console.error('–û–±—â–∞—è –æ—à–∏–±–∫–∞:', error); 
      }
      finally { 
        isLoading = false; 
        if (loadingOverlay && loadingOverlay.parentNode) {
          loadingOverlay.parentNode.removeChild(loadingOverlay);
        }
      }
    }

    function navigateDate(days) {
      const currentDate = new Date(datePicker.value);
      currentDate.setDate(currentDate.getDate() + days);
      const newDate = currentDate.toISOString().split('T')[0];
      datePicker.value = newDate;
      loadData();
    }

    function setToday() {
      const t = new Date();
      const iso = `${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,'0')}-${String(t.getDate()).padStart(2,'0')}`;
      datePicker.value = iso;
      loadData();
    }

    function init() {
      buildHeaders();
      buildBody();
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      setToday();
      
      // –ù–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      datePicker.addEventListener('change', loadData);
      prevDayBtn.addEventListener('click', () => navigateDate(-1));
      nextDayBtn.addEventListener('click', () => navigateDate(1));
      toggleAllBtn.addEventListener('click', () => toggleAll());
      todayBtn.addEventListener('click', setToday);
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∫—Ä–æ–ª–ª–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–≤–µ—Ä—Ö"
      tableWrapper.addEventListener('scroll', () => {
        if (tableWrapper.scrollTop > 200) {
          scrollTopBtn.style.display = 'flex';
        } else {
          scrollTopBtn.style.display = 'none';
        }
      });
      
      scrollTopBtn.addEventListener('click', () => {
        tableWrapper.scrollTo({ top: 0, behavior: 'smooth' });
      });
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≥–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
      document.addEventListener('keydown', (e) => {
        if (e.target !== datePicker) {
          if (e.key === 'ArrowLeft') navigateDate(-1);
          if (e.key === 'ArrowRight') navigateDate(1);
          if (e.key === 't' || e.key === 'T') setToday();
          if (e.key === 'a' || e.key === 'A') toggleAll();
        }
      });
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ —Å—Ç—Ä–æ–∫ –∏ —Å—Ç–æ–ª–±—Ü–æ–≤
      document.addEventListener('mouseover', function(e) {
        if (e.target.tagName === 'TD' || e.target.tagName === 'TH') {
          const cell = e.target;
          const ci = cell.cellIndex;
          const row = cell.parentElement;
          
          // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏
          if (row && row.tagName === 'TR') {
            row.querySelectorAll('td, th').forEach(c => c.classList.add('hover-row'));
          }
          
          // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç–æ–ª–±—Ü–∞
          if (ci >= 0) {
            document.querySelectorAll(`#main-table tr`).forEach(r => {
              const c = r.children[ci];
              if (c) c.classList.add('hover-col');
            });
          }
        }
      });
      
      document.addEventListener('mouseout', function(e) {
        if (e.target.tagName === 'TD' || e.target.tagName === 'TH') {
          document.querySelectorAll('.hover-row, .hover-col').forEach(el => {
            el.classList.remove('hover-row', 'hover-col');
          });
        }
      });
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
      setTimeout(() => toggleAll(true), 100);
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –ª–æ–≥–æ—Ç–∏–ø—É
      document.getElementById('logo-wrapper').addEventListener('click', () => { 
        datePicker.click(); 
      });
    }

    window.addEventListener('load', init);
    
    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –Ω–∞ —Ç–∞–±–ª–∏—Ü–µ
    document.addEventListener('contextmenu', (e) => {
      if (e.target.closest('#main-table')) {
        e.preventDefault();
      }
    });
    
    // –£–ª—É—á—à–∞–µ–º —Ä–∞–±–æ—Ç—É —Å–µ–Ω—Å–æ—Ä–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞
    let isScrolling = false;
    let startY = 0;
    let startX = 0;
    
    tableWrapper.addEventListener('touchstart', (e) => {
      isScrolling = true;
      startY = e.touches[0].pageY;
      startX = e.touches[0].pageX;
    });
    
    tableWrapper.addEventListener('touchmove', (e) => {
      if (!isScrolling) return;
      e.preventDefault();
    });
    
    tableWrapper.addEventListener('touchend', () => {
      isScrolling = false;
    });
  </script>
</body>
</html>