<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ë–æ—É–ª–∏–Ω–≥ - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</title>
  <style>
    /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ */
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f4f6fa;
      color: #333;
    }
    
    /* –ü–æ–≤–æ—Ä–æ—Ç —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    @media screen and (max-width: 1024px) {
      html, body {
        transform: rotate(90deg);
        transform-origin: center center;
        width: 100vh;
        height: 100vw;
        position: fixed;
        top: 50%;
        left: 50%;
        margin-top: -50vw;
        margin-left: -50vh;
      }
    }
    
    .container {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 10px;
      overflow: hidden;
    }
    
    /* –®–∞–ø–∫–∞ */
    .header {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      padding: 10px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .logo {
      width: 40px;
      height: 40px;
      margin-right: 15px;
      cursor: pointer;
    }
    
    .logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .date-input-container {
      flex: 1;
    }
    
    #date-picker {
      width: 100%;
      padding: 10px;
      font-size: 14px;
      font-weight: 600;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      background: white;
      color: #333;
      cursor: pointer;
      outline: none;
      transition: border-color 0.3s;
    }
    
    #date-picker:focus {
      border-color: #dc143c;
    }
    
    /* –û–±—â–∏–π —Ç–æ—Ç–∞–ª */
    .total-display {
      padding: 8px;
      margin-bottom: 10px;
      background: white;
      border-radius: 8px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      color: #2c3e50;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç–∞–±–ª–∏—Ü—ã */
    .table-container {
      flex: 1;
      position: relative;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .table-scroll {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }
    
    /* –°—Ç–∏–ª–∏ —Ç–∞–±–ª–∏—Ü—ã */
    table {
      border-collapse: collapse;
      width: auto;
      min-width: 800px;
      background: white;
    }
    
    /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ */
    #main-table th:nth-child(1),
    #main-table td:nth-child(1) {
      position: sticky;
      left: 0;
      z-index: 10;
      background: #dc143c;
      color: white;
      font-weight: bold;
      width: 45px;
      min-width: 45px;
      text-align: center;
    }
    
    #main-table th:nth-child(2),
    #main-table td:nth-child(2) {
      position: sticky;
      left: 45px;
      z-index: 9;
      background: #2c3e50;
      color: white;
      font-weight: 600;
      width: 80px;
      min-width: 80px;
      text-align: center;
    }
    
    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ */
    th {
      background: #f8f9fa;
      color: #2c3e50;
      font-weight: 600;
      border: 1px solid #dee2e6;
      position: sticky;
      top: 0;
      z-index: 8;
    }
    
    /* –Ø—á–µ–π–∫–∏ */
    td, th {
      height: 25px;
      font-size: 12px;
      border: 1px solid #dee2e6;
      text-align: center;
      vertical-align: middle;
      padding: 0 3px;
      white-space: nowrap;
    }
    
    /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —è—á–µ–π–∫–∏ */
    .active-cell {
      background: #2c3e50 !important;
      color: white !important;
      font-weight: bold;
    }
    
    .booked-cell {
      color: #666;
      font-weight: 500;
    }
    
    .free-cell {
      color: #dc143c;
      font-weight: 600;
    }
    
    /* –ö–Ω–æ–ø–∫–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ */
    .group-btn {
      display: inline-block;
      width: 20px;
      height: 20px;
      background: #2c3e50;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      font-weight: bold;
      font-size: 12px;
      line-height: 18px;
      margin: 0;
      padding: 0;
      vertical-align: middle;
    }
    
    .group-btn:hover {
      background: #dc143c;
    }
    
    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ */
    .time-header {
      display: flex;
      flex-direction: column;
      font-size: 10px;
      line-height: 1.2;
    }
    
    .hour {
      font-weight: bold;
    }
    
    /* –°–∫—Ä—ã—Ç—ã–µ –∫–æ–ª–æ–Ω–∫–∏ */
    .hidden {
      display: none !important;
    }
    
    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      color: white;
      font-size: 18px;
      font-weight: 500;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s linear infinite;
      margin-right: 15px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 768px) {
      .container {
        padding: 5px;
      }
      
      .header {
        padding: 8px;
        margin-bottom: 8px;
      }
      
      .logo {
        width: 35px;
        height: 35px;
      }
      
      #date-picker {
        padding: 8px;
        font-size: 13px;
      }
      
      td, th {
        height: 22px;
        font-size: 11px;
      }
      
      #main-table th:nth-child(1),
      #main-table td:nth-child(1) {
        width: 40px;
        min-width: 40px;
      }
      
      #main-table th:nth-child(2),
      #main-table td:nth-child(2) {
        left: 40px;
        width: 70px;
        min-width: 70px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo" id="logo-btn">
        <img src="https://i.postimg.cc/SQ3RgNsQ/image.png" alt="–õ–æ–≥–æ—Ç–∏–ø">
      </div>
      <div class="date-input-container">
        <input type="date" id="date-picker">
      </div>
    </div>
    
    <div class="total-display">
      –û–±—â–µ–µ –≤—Ä–µ–º—è –±—Ä–æ–Ω–µ–π: <span id="overall-total">0—á 0–º</span>
    </div>
    
    <div class="table-container">
      <div class="table-scroll">
        <table id="main-table">
          <thead>
            <tr id="letter-row">
              <th>–î–æ—Ä.</th>
              <th>–ò—Ç–æ–≥</th>
              <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –º–∏–Ω—É—Ç –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </tr>
            <tr id="time-row">
              <th></th>
              <th></th>
              <!-- –ó–∞–≥–æ–ª–æ–≤–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </tr>
          </thead>
          <tbody id="table-body">
            <!-- –°—Ç—Ä–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
          </tbody>
        </table>
      </div>
    </div>
  </div>
  
  <div class="loading-overlay" id="loading-overlay" style="display: none;">
    <div class="spinner"></div>
    <div id="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  </div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    const CONFIG = {
      // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π URL –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –ø–æ–∑–∂–µ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π
      SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbwJcg8Ov4_-ijxTLQxJDjm2-IKCmI8l0AAsDo4sMeU-avSQp3F_E54gyB7f26z_KaE0FA/exec',
      TOTAL_MINUTES: 1440, // 24 —á–∞—Å–∞
      GROUP_INTERVAL: 15,
      GROUP_SIZE: 14,
      LANES: 16
    };

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let allGroups = [];
    let allDataCells = [];
    let currentDate = '';
    let isLoading = false;

    // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
    const elements = {
      datePicker: document.getElementById('date-picker'),
      overallTotal: document.getElementById('overall-total'),
      tableBody: document.getElementById('table-body'),
      letterRow: document.getElementById('letter-row'),
      timeRow: document.getElementById('time-row'),
      loadingOverlay: document.getElementById('loading-overlay'),
      loadingText: document.getElementById('loading-text'),
      logoBtn: document.getElementById('logo-btn')
    };

    // –§—É–Ω–∫—Ü–∏–∏ —É—Ç–∏–ª–∏—Ç—ã
    function formatMinutes(minutes) {
      const hours = Math.floor(minutes / 60);
      const mins = minutes % 60;
      return `${hours}—á ${mins}–º`;
    }

    function showLoading(message = '–ó–∞–≥—Ä—É–∑–∫–∞...') {
      elements.loadingText.textContent = message;
      elements.loadingOverlay.style.display = 'flex';
    }

    function hideLoading() {
      elements.loadingOverlay.style.display = 'none';
    }

    // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã
    function buildTableStructure() {
      // –°—Ç—Ä–æ–∏–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
      buildHeaders();
      
      // –°—Ç—Ä–æ–∏–º —Ç–µ–ª–æ —Ç–∞–±–ª–∏—Ü—ã
      buildTableBody();
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –≥—Ä—É–ø–ø—ã –∫–∞–∫ —Å–≤–µ—Ä–Ω—É—Ç—ã–µ
      setTimeout(() => {
        toggleAllGroups(true);
      }, 100);
    }

    function buildHeaders() {
      // –û—á–∏—â–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
      while (elements.letterRow.children.length > 2) {
        elements.letterRow.removeChild(elements.letterRow.lastChild);
      }
      while (elements.timeRow.children.length > 2) {
        elements.timeRow.removeChild(elements.timeRow.lastChild);
      }
      
      allGroups = [];
      
      // –°–æ–∑–¥–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–∏–Ω—É—Ç—ã
      for (let i = 1; i <= CONFIG.TOTAL_MINUTES; i++) {
        const minute = i - 1; // 0-1439
        const hour = Math.floor(minute / 60);
        const min = minute % 60;
        
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏
        const thLetter = document.createElement('th');
        
        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏
        const thTime = document.createElement('th');
        const timeDiv = document.createElement('div');
        timeDiv.className = 'time-header';
        timeDiv.innerHTML = `<div class="hour">${String(hour).padStart(2, '0')}</div>
                            <div class="minute">${String(min).padStart(2, '0')}</div>`;
        thTime.appendChild(timeDiv);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
        if (minute % CONFIG.GROUP_INTERVAL === 0) {
          const groupStart = minute;
          const groupEnd = Math.min(groupStart + CONFIG.GROUP_SIZE - 1, CONFIG.TOTAL_MINUTES - 1);
          const groupIndexes = [];
          
          for (let j = groupStart; j <= groupEnd; j++) {
            groupIndexes.push(j);
          }
          
          if (groupIndexes.length > 0) {
            const groupBtn = document.createElement('button');
            groupBtn.className = 'group-btn';
            groupBtn.textContent = '+';
            groupBtn.title = `–ì—Ä—É–ø–ø–∞ ${formatMinutes(groupIndexes[0])}-${formatMinutes(groupIndexes[groupIndexes.length-1])}`;
            
            groupBtn.addEventListener('click', (e) => {
              e.stopPropagation();
              toggleGroup(groupIndexes);
              const isHidden = elements.timeRow.children[groupIndexes[0] + 2].classList.contains('hidden');
              groupBtn.textContent = isHidden ? '+' : '-';
            });
            
            thLetter.appendChild(groupBtn);
            allGroups.push(groupIndexes);
          }
        }
        
        elements.letterRow.appendChild(thLetter);
        elements.timeRow.appendChild(thTime);
      }
    }

    function buildTableBody() {
      elements.tableBody.innerHTML = '';
      allDataCells = [];
      
      // –°–æ–∑–¥–∞–µ–º 16 —Å—Ç—Ä–æ–∫ (–¥–æ—Ä–æ–∂–µ–∫)
      for (let lane = 0; lane < CONFIG.LANES; lane++) {
        const row = document.createElement('tr');
        
        // –Ø—á–µ–π–∫–∞ –Ω–æ–º–µ—Ä–∞ –¥–æ—Ä–æ–∂–∫–∏
        const laneCell = document.createElement('th');
        laneCell.textContent = lane + 1;
        row.appendChild(laneCell);
        
        // –Ø—á–µ–π–∫–∞ –∏—Ç–æ–≥–∞ –ø–æ –¥–æ—Ä–æ–∂–∫–µ
        const totalCell = document.createElement('th');
        totalCell.textContent = '0—á 0–º';
        row.appendChild(totalCell);
        
        // –Ø—á–µ–π–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–∏–Ω—É—Ç—ã
        const minuteCells = [];
        for (let minute = 0; minute < CONFIG.TOTAL_MINUTES; minute++) {
          const cell = document.createElement('td');
          cell.dataset.lane = lane;
          cell.dataset.minute = minute;
          row.appendChild(cell);
          minuteCells.push(cell);
        }
        
        elements.tableBody.appendChild(row);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ —è—á–µ–π–∫–∏
        allDataCells.push({
          lane: lane,
          totalCell: totalCell,
          cells: minuteCells
        });
      }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≥—Ä—É–ø–ø–∞–º–∏
    function toggleGroup(groupIndexes) {
      groupIndexes.forEach(index => {
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
        if (elements.letterRow.children[index + 2]) {
          elements.letterRow.children[index + 2].classList.toggle('hidden');
        }
        if (elements.timeRow.children[index + 2]) {
          elements.timeRow.children[index + 2].classList.toggle('hidden');
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —è—á–µ–π–∫–∏ –≤ —Ç–µ–ª–µ —Ç–∞–±–ª–∏—Ü—ã
        elements.tableBody.querySelectorAll('tr').forEach(row => {
          if (row.children[index + 2]) {
            row.children[index + 2].classList.toggle('hidden');
          }
        });
      });
    }

    function toggleAllGroups(collapse = null) {
      const shouldCollapse = collapse !== null ? collapse : !allGroups.some(group => {
        const firstCell = elements.timeRow.children[group[0] + 2];
        return firstCell && !firstCell.classList.contains('hidden');
      });
      
      allGroups.forEach(group => {
        const firstCell = elements.timeRow.children[group[0] + 2];
        if (firstCell) {
          const isHidden = firstCell.classList.contains('hidden');
          if ((shouldCollapse && !isHidden) || (!shouldCollapse && isHidden)) {
            toggleGroup(group);
          }
        }
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–æ–∫
      document.querySelectorAll('.group-btn').forEach(btn => {
        btn.textContent = shouldCollapse ? '+' : '-';
      });
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    async function loadData() {
      const selectedDate = elements.datePicker.value;
      if (!selectedDate || isLoading) return;
      
      currentDate = selectedDate;
      isLoading = true;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      showLoading('–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...');
      
      // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ
      allDataCells.forEach(laneData => {
        laneData.totalCell.textContent = '0—á 0–º';
        laneData.cells.forEach(cell => {
          cell.textContent = '';
          cell.className = '';
        });
      });
      elements.overallTotal.textContent = '0—á 0–º';
      
      let totalBookedMinutes = 0;
      let loadedLanes = 0;
      
      try {
        // –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ Google Apps Script
        const testData = generateTestData();
        
        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        testData.forEach((laneData, laneIndex) => {
          if (laneIndex < allDataCells.length) {
            processLaneData(laneIndex, laneData);
            loadedLanes++;
            elements.loadingText.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${loadedLanes} –∏–∑ ${CONFIG.LANES} –¥–æ—Ä–æ–∂–µ–∫`;
          }
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–∏–π –∏—Ç–æ–≥
        elements.overallTotal.textContent = formatMinutes(totalBookedMinutes);
        
        // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
        setTimeout(hideLoading, 500);
        
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
        elements.loadingText.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
        setTimeout(hideLoading, 2000);
      } finally {
        isLoading = false;
      }
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏)
    function generateTestData() {
      const lanes = [];
      
      for (let lane = 0; lane < CONFIG.LANES; lane++) {
        const bookedTimes = [];
        const busyTimes = [];
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –±—Ä–æ–Ω–∏
        for (let i = 0; i < 5; i++) {
          const hour = Math.floor(Math.random() * 24);
          const minute = Math.floor(Math.random() * 4) * 15; // 0, 15, 30, 45
          const timeStr = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
          bookedTimes.push(timeStr);
        }
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –∑–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã (–Ω–µ –±—Ä–æ–Ω–∏)
        for (let i = 0; i < 10; i++) {
          const hour = Math.floor(Math.random() * 24);
          const minute = Math.floor(Math.random() * 12) * 5; // 0, 5, 10, ..., 55
          const timeStr = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
          if (!bookedTimes.includes(timeStr)) {
            busyTimes.push(timeStr);
          }
        }
        
        lanes.push({
          c: bookedTimes, // booked (–±—Ä–æ–Ω—å)
          b: busyTimes    // busy (–∑–∞–Ω—è—Ç–æ)
        });
      }
      
      return lanes;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–¥–Ω–æ–π –¥–æ—Ä–æ–∂–∫–∏
    function processLaneData(laneIndex, data) {
      const laneData = allDataCells[laneIndex];
      let bookedMinutes = 0;
      
      laneData.cells.forEach((cell, minuteIndex) => {
        const hour = Math.floor(minuteIndex / 60);
        const minute = minuteIndex % 60;
        const timeKey = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;
        
        // –û—á–∏—â–∞–µ–º —è—á–µ–π–∫—É
        cell.textContent = '';
        cell.className = '';
        
        if (data.c && data.c.includes(timeKey)) {
          // –ë—Ä–æ–Ω—å
          cell.textContent = 'üé≥';
          cell.className = 'active-cell';
          bookedMinutes++;
        } else if (data.b && data.b.includes(timeKey)) {
          // –ó–∞–Ω—è—Ç–æ (–Ω–µ –±—Ä–æ–Ω—å)
          cell.textContent = '‚óè';
          cell.className = 'booked-cell';
        } else {
          // –°–≤–æ–±–æ–¥–Ω–æ
          cell.textContent = '‚ö°Ô∏é';
          cell.className = 'free-cell';
        }
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏—Ç–æ–≥ –ø–æ –¥–æ—Ä–æ–∂–∫–µ
      laneData.totalCell.textContent = formatMinutes(bookedMinutes);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∫ –æ–±—â–µ–º—É —Å—á–µ—Ç—á–∏–∫—É
      const currentTotal = parseInt(elements.overallTotal.textContent.split('—á')[0]) * 60 + 
                          parseInt(elements.overallTotal.textContent.split('—á')[1].split('–º')[0].trim());
      elements.overallTotal.textContent = formatMinutes(currentTotal + bookedMinutes);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    function initApp() {
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–æ–¥–Ω—è—à–Ω—é—é –¥–∞—Ç—É
      const today = new Date();
      const todayStr = today.toISOString().split('T')[0];
      elements.datePicker.value = todayStr;
      elements.datePicker.max = todayStr; // –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è –∏–ª–∏ —Ä–∞–Ω—å—à–µ
      
      // –°—Ç—Ä–æ–∏–º —Ç–∞–±–ª–∏—Ü—É
      buildTableStructure();
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      elements.datePicker.addEventListener('change', loadData);
      elements.logoBtn.addEventListener('click', () => {
        elements.datePicker.focus();
        elements.datePicker.showPicker?.();
      });
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      setTimeout(loadData, 500);
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
      initHoverEffects();
      
      // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É
      console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ. –î–∞—Ç–∞:', todayStr);
    }

    // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫ –∏ –∫–æ–ª–æ–Ω–æ–∫
    function initHoverEffects() {
      let hoverTimeout;
      
      document.addEventListener('mouseover', (e) => {
        const cell = e.target;
        if (cell.tagName === 'TD' || cell.tagName === 'TH') {
          clearTimeout(hoverTimeout);
          
          const row = cell.closest('tr');
          const colIndex = cell.cellIndex;
          
          // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏
          if (row) {
            row.querySelectorAll('td, th').forEach(c => {
              c.style.backgroundColor = 'rgba(250, 132, 156, 0.15)';
            });
          }
          
          // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∫–æ–ª–æ–Ω–∫–∏
          if (colIndex >= 0) {
            document.querySelectorAll('#main-table tr').forEach(r => {
              const colCell = r.children[colIndex];
              if (colCell) {
                colCell.style.backgroundColor = 'rgba(250, 132, 156, 0.1)';
              }
            });
          }
        }
      });
      
      document.addEventListener('mouseout', (e) => {
        if (e.target.tagName === 'TD' || e.target.tagName === 'TH') {
          hoverTimeout = setTimeout(() => {
            document.querySelectorAll('#main-table td, #main-table th').forEach(cell => {
              cell.style.backgroundColor = '';
            });
          }, 100);
        }
      });
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    window.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>